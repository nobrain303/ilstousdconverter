<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ILS ↔ USD Converter</title>

<style>
body {
  margin: 0;
  background: #121417;
  color: white;
  font-family: Arial, sans-serif;
  height: 100vh;
  display: flex;
  flex-direction: column;
}

.container {
  padding: 20px;
  flex: 1;
}

.rate {
  text-align: center;
  color: #9fb4cc;
  font-size: 20px;
}

.updated {
  text-align: center;
  font-size: 12px;
  color: #8a8a8a;
  margin-top: 4px;
}

.warning {
  text-align: center;
  color: #ff6b6b;
  font-size: 13px;
  display: none;
  margin-top: 6px;
}

.field {
  display: flex;
  align-items: center;
  background: #1b1f24;
  border-radius: 12px;
  padding: 14px;
  margin-top: 16px;
  border: 2px solid transparent;
}

.field.active {
  border-color: #4f6fff;
}

.symbol {
  font-size: 26px;
  margin-right: 10px;
}

.display {
  flex: 1;
  font-size: 24px;
  white-space: nowrap;
}

.cursor {
  display: inline-block;
  width: 2px;
  height: 26px;
  background: white;
  margin-left: 2px;
  animation: blink 1s steps(1) infinite;
}

@keyframes blink {
  50% { opacity: 0; }
}

/* Number pad */
.numpad {
  background: #0f1114;
  padding: 10px;
}

.pad-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px;
}

.pad-btn {
  background: #1b1f24;
  color: white;
  font-size: 22px;
  padding: 18px;
  border-radius: 10px;
  text-align: center;
  user-select: none;
}

.pad-btn:active {
  background: #2a3038;
}

.footer {
  display: flex;
  justify-content: space-between;
  color: #8a8a8a;
  font-size: 12px;
  padding: 6px 12px;
}
</style>
</head>

<body>

<div class="container">
  <div class="rate" id="rateText">₪_._ = $1</div>
  <div class="updated" id="updated">Last updated: —</div>
  <div class="warning" id="warning">Not accurate, no network</div>

  <div class="field active" id="ilsField" onclick="setActive('ils')">
    <div class="symbol">₪</div>
    <div class="display" id="ilsDisplay">0<span class="cursor"></span></div>
  </div>

  <div class="field" id="usdField" onclick="setActive('usd')">
    <div class="symbol">$</div>
    <div class="display" id="usdDisplay">0</div>
  </div>
</div>

<div class="footer">
  <div id="countdown">Next refresh: 10:00</div>
</div>

<div class="numpad">
  <div class="pad-grid">
    <div class="pad-btn" onclick="press('1')">1</div>
    <div class="pad-btn" onclick="press('2')">2</div>
    <div class="pad-btn" onclick="press('3')">3</div>
    <div class="pad-btn" onclick="press('4')">4</div>
    <div class="pad-btn" onclick="press('5')">5</div>
    <div class="pad-btn" onclick="press('6')">6</div>
    <div class="pad-btn" onclick="press('7')">7</div>
    <div class="pad-btn" onclick="press('8')">8</div>
    <div class="pad-btn" onclick="press('9')">9</div>
    <div class="pad-btn" onclick="press('.')">.</div>
    <div class="pad-btn" onclick="press('0')">0</div>
    <div class="pad-btn" onclick="backspace()">⌫</div>
  </div>
</div>

<script>
let rate = 0;
let active = "ils";
let seconds = 600;
let values = { ils: "0", usd: "0" };

function setActive(id) {
  active = id;

  document.getElementById("ilsField").classList.toggle("active", id === "ils");
  document.getElementById("usdField").classList.toggle("active", id === "usd");

  // Clear both fields when any is tapped
  values.ils = "0";
  values.usd = "0";

  render();
}

function press(val) {
  if (val === "." && values[active].includes(".")) return;
  if (values[active] === "0" && val !== ".") values[active] = "";
  values[active] += val;
  convert();
  navigator.vibrate?.(40); // haptic feedback
}

function backspace() {
  values[active] = values[active].slice(0, -1) || "0";
  convert();
  navigator.vibrate?.(40); // haptic feedback
}

function convert() {
  if (rate === 0) {
    values.ils = "0";
    values.usd = "0";
    render();
    return;
  }

  if (active === "ils") {
    values.usd = (parseFloat(values.ils) / rate || 0).toFixed(2);
  } else {
    values.ils = (parseFloat(values.usd) * rate || 0).toFixed(2);
  }

  render();
}

function formatNumber(val) {
  const parts = val.split(".");
  parts[0] = Number(parts[0]).toLocaleString('en-US');
  return parts.join(".");
}

function render() {
  ilsDisplay.innerHTML = formatNumber(values.ils) + (active === "ils" ? '<span class="cursor"></span>' : '');
  usdDisplay.innerHTML = formatNumber(values.usd) + (active === "usd" ? '<span class="cursor"></span>' : '');
}

async function fetchRate() {
  try {
    const res = await fetch("https://api.frankfurter.app/latest?from=USD&to=ILS");
    const data = await res.json();
    rate = data.rates.ILS;

    localStorage.setItem("rate", rate);
    localStorage.setItem("time", new Date().toLocaleTimeString());

    rateText.innerText = ₪${rate.toFixed(3)} = $1;
    updated.innerText = "Last updated: " + localStorage.getItem("time");
    warning.style.display = "none";
    seconds = 600;
  } catch {
    rate = Number(localStorage.getItem("rate")) || 0;
    warning.style.display = "block";
  }
}

setInterval(() => {
  if (seconds > 0) seconds--;
  const m = String(Math.floor(seconds / 60)).padStart(2, "0");
  const s = String(seconds % 60).padStart(2, "0");
  countdown.innerText = Next refresh: ${m}:${s};
}, 1000);

fetchRate();
setInterval(fetchRate, 600000);
</script>

</body>
</html>